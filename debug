#1/bin/bash

if [[ $1 = "-help" ]] || [[ $1 = "-?" ]] || [[ $1 = "-h" ]]; then
    printf "usage: debug <implementation>\r\n"
    printf "\r\n"
    printf "Call debug for the specified implementation flow; the default is 'docker'.\r\n"
    printf "Possible implementation values are found in the ./ci directory.\r\n"
    printf "\r\n"
    exit 0
fi

IMPL=$1

if [[ -z $1 ]]; then
    IMPL="docker"
fi

COMMAND="debug"
CONTAINERORIMAGE=$2
TARGETIDENTIFIER=$3

if [[ -z ${CONTAINERORIMAGE} ]]; then
    CONTAINERORIMAGE="image"
fi

if [[ !(${CONTAINERORIMAGE} = "container") && !(${CONTAINERORIMAGE} = "image")]]; then
    printf "Invalid type specified, must be either 'container' or 'image'\r\n"
    exit 1
fi

if [[ -z $TARGETIDENTIFIER ]]; then
    printf "\r\n"
    printf "Please specify an identifier for the ${CONTAINERORIMAGE} to debug.\r\n"
    if [[ $CONTAINERORIMAGE = "container" ]]; then
        printf "Use 'docker ps' to list running containers\r\n"
    fi
    if [[ $CONTAINERORIMAGE = "image" ]]; then
        printf "Use 'docker images' to list available images\r\n"
    fi
    printf "\r\nexample: debug ${CONTAINERORIMAGE} 555efb\r\n"
    exit 1
fi

cd ./ci
./exec.sh ${IMPL} ${COMMAND} ${CONTAINERORIMAGE} ${TARGETIDENTIFIER}
cd ..
